@(article: Article, topViewArticles: List[Article], topReplyArticles: List[Article])(implicit request: RequestHeader, viewHelper: services.ViewHelper)
@import helper._
@uid() = @{request.session.get("uid").getOrElse("-1").toInt}
@main("欢迎来到社区！") {
<div class="main layui-clear">
  <div class="wrap">
    <div class="content detail">
      <div class="fly-panel detail-box">
        <h1>@article.title</h1>
        <div class="fly-tip fly-detail-hint" data-id="{{rows.id}}">
          @if(article.top){
          <span class="fly-tip-stick">置顶帖</span>
          }
          @if(article.recommended){
          <span class="fly-tip-jing">精帖</span>
          }
          @if(article.replies.isEmpty){
          <span>无回复</span>
          }else{
          <span>已回复</span>
          }
          <!-- <span class="fly-tip-jie">已采纳</span> -->

          <!-- <span class="jie-admin" type="del" style="margin-left: 20px;">删除</span>
          <span class="jie-admin" type="set" field="stick" rank="1">置顶</span>
          <span class="jie-admin" type="set" field="stick" rank="0" style="background-color:#ccc;">取消置顶</span>
          <span class="jie-admin" type="set" field="status" rank="1">加精</span>
          <span class="jie-admin" type="set" field="status" rank="0" style="background-color:#ccc;">取消加精</span> -->

          <div class="fly-list-hint">
            <i class="iconfont" title="回答">&#xe60c;</i> @article.replies.size
            <i class="iconfont" title="人气">&#xe60b;</i> @article.viewStat.count
          </div>
        </div>
        <div class="detail-about">
          <a class="jie-user" href="">
            <img src="@article.author.headImg" alt="">
            <cite>
              @article.author.name
              <em>1分钟前发布</em>
            </cite>
          </a>
          @if(viewHelper.isLogin){
          <div class="detail-hits" data-id="@article._id">
            @if(article.author._id == request.session.get("uid").getOrElse("")){
            <span class="layui-btn layui-btn-mini jie-admin"><a href="/article/edit?_id=@{article._id}">编辑此贴</a></span>
            }
            @if(utils.BitmapUtil.fromBase64String(article.collectStat.bitmap).contains(request.session.get("uid").getOrElse("-1").toInt)){
            <span class="layui-btn layui-btn-mini jie-admin  layui-btn-danger" type="collect" data-type="remove" data-token="@CSRF.getToken.value">取消收藏</span>
            }else{
            <span class="layui-btn layui-btn-mini jie-admin " type="collect" data-type="add" data-token="@CSRF.getToken.value">收藏</span>
            }
          </div>
          }
        </div>

        <div class="detail-body photos" style="margin-bottom: 20px;">
          @Html(article.content)
        </div>
      </div>

      <div class="fly-panel detail-box" style="padding-top: 0;">
        <a name="comment"></a>
        <ul class="jieda photos" id="jieda">
          @for(r <- article.replies){
          @defining(utils.BitmapUtil.fromBase64String(r.voteStat.bitmap)){ bitmap =>
          <li data-aid="@{article._id}" data-rid="@{r._id}" data-uid="@{r.author._id}">
            <a name="item-@{r._id}"></a>
            <div class="detail-about detail-about-reply">
              <a class="jie-user" href="">
                <img src="@{r.author.headImg}" alt="">
                <cite>
                  <i>@{r.author.name}</i>
                </cite>
              </a>
              <div class="detail-hits">
                <span>刚刚</span>
              </div>
            </div>
            <div class="detail-body jieda-body">
              @Html(r.content)
            </div>
            @if(viewHelper.isLogin){
            <div class="jieda-reply">
              <span class="jieda-zan @if(bitmap.contains(uid)){zanok}" type="zan" data-token="@CSRF.getToken.value"><i class="iconfont icon-zan"></i><em>@{r.voteStat.count}</em></span>
              <span type="reply"><i class="iconfont icon-svgmoban53"></i>回复</span>
              <div class="jieda-admin">
                <span type="edit">编辑</span>
                <span type="del">删除</span>
                <span class="jieda-accept" type="accept">采纳</span>
              </div>
            </div>
            }
          </li>
          }
          }
          @if(article.replies.isEmpty){
          <li class="fly-none">没有任何回答</li>
          }
        </ul>
        @if(viewHelper.isLogin){
        <div class="layui-form layui-form-pane">
          <form action="/article/reply" method="post">
            <div class="layui-form-item layui-form-text">
              <div class="layui-input-block">
                <textarea id="L_content" name="content" required lay-verify="required" placeholder="我要回答"  class="layui-textarea fly-editor" style="height: 150px;"></textarea>
              </div>
            </div>
            <div class="layui-form-item">
              @CSRF.formField
              <input type="hidden" name="_id" value="@article._id">
              <input id="at-input" type="hidden" name="at" value="">
              <button class="layui-btn" lay-submit>提交回答</button>
            </div>
          </form>
        </div>
        }
      </div>
    </div>
  </div>

  <div class="edge">
    <dl class="fly-panel fly-list-one">
      <dt class="fly-panel-title">最近热帖</dt>
      @for(a <- topViewArticles){
      <dd>
        <a href="/article/view?_id=@{a._id}">@a.title</a>
        <span><i class="iconfont">&#xe60b;</i> @a.viewStat.count</span>
      </dd>
      }
    </dl>

    <dl class="fly-panel fly-list-one">
      <dt class="fly-panel-title">近期热议</dt>
      @for(a <- topReplyArticles){
      <dd>
        <a href="/article/view?_id=@{a._id}">@a.title</a>
        <span><i class="iconfont">&#xe60c;</i> @a.replyStat.count</span>
      </dd>
      }
    </dl>
  </div>
</div>
}

<script>
layui.cache.page = 'jie';
</script>
